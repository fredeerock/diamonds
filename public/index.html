<!doctype html>
<html> 
<head>
	<meta charset="utf-8">
	<title>Diamonds</title>
	<!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

	<link rel="stylesheet" href="styles/main.css">

	<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>

	<script src="/socket.io/socket.io.js"></script>
	<!-- <script type="text/javascript" src="js/Tone.min.js"></script> -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>

<body>
	    <div id="gradient" />

		<div class="sec sw">

		<!-- <h1 onclick="causeSound.triggerCauseway();"><span class="mainTitle">Causeway</span></h1> -->			
		<div class="sd">

		</div>

		<div class="st" style="display: none;">

		</div>

	</div>
	<pre>
	<p>Vincent A. Cellucci

Bound by Digital Countries

all know who you are whole-hearted 
                           you download an episode often
        hold down apostasy jobs 
                              dancing sunlight in psychoanalysis 

                 new dimension     new struggle
street view drop in the dow jones 
departs on facebook, twitter, google maps 
can't afford allegiance                 
                       rates "the 20th century expressed this"  
                                                            the positive forces 
                                    eliminate the common denominator 
                                                        all regularities 
                                                        steps toward unification 
                                       built borderless   cheap   even free

we farmed fish fisherman
       assign values to the viewer
                when streaming's easy 
how we numb
used to watching
                                 people drown
everybody today
unraveled connection
                     everyone elements 

answer particles      an hour of sea
each and every year
                  wasn't taken for granted          
there are 14,000 planes
the amount of salmon              to disappear 
damns EVERYWHERE
but are there interfaces
                                               that tell of great nature?

we often say to companies 
                                                      eating themselves, evolve 
                               it becomes a threat to spark a solution

                                                              and we keep growing
                                             say this is what I found
attempting to reach outside 
                                                        the world and make way               

complicit comeback 
                                       of the collaborative 
                                                    red-eye flock
                                                    don't mind stepping back for clean water

the radioactive boys of dust 
threaten observers       
committed organic 
                                     ubiquity of gluttons
                                                           outside interference
felt like today
                              a fish    now two    blooms
                              mean moon phenomena 
symmetries struggle cyborgs

                   disarm 
the certainty of domination 
                   preferred by our elders  
                   defines the nowhered
                                                       coded origins story 
                                                               refuge-floating
                                     opaque day-to-today biology 

mode of mud
matter provided
man analyzed Eden 
then analyzed 
                            the people
                            the good and the grave
                                              one garden; we script war
                     cross-hairs two tiny lines joined against

our utopia is our apocalypse
                                                       cripples water
                                          people taking shelter 
as if concern were an
enforced homelessness
                                    the dream of infrastructure
                                                   limited to the global
                                                   intimately unscathed 

we tool the endless pursuit 
                                       one which does not us
                       manufacturing a hi-tech public
                                                     sight-servers 
                        industry synthesis
                        armistress 
                      teller technology 

electronics educated 
the age of eyes 
                                out of visible energies 
                    arises art 
displacing 
diamonds in dystopia 

                        the conditions that carry 
                                     fear in the patient 
               superb skin 
liquid parts
lights in the shape of your birthday

we want the real and painstaking 
                  to draw it out as far as planets 

everyone who stopped by responded 
                                                   with a crisis

                                                                solution says
                                    I would haven
                                                    withholding petroleum 
                        essential fuel technology 
                        gaping social mirrors 
 mediated Earth 
                     coal-fired population 
                                                   who doubts today
                                            many need its waste 

death is building its answers

I'm gonna compare stars 
       go adaptable 

25 microbes without 
                                        we do we knowledge 
            come on Earth 
                              media 
    toxic therapy 
                              discuss this child
                                                          too expensive to let 
                      under evening thriving 
 irrigating minds: 

the one prototype for change 

                 more giving systems 
sea-sized leaks 
                   deepwater indulgence 

the justice problem when 
I start talking about failure
             won't fix the fissures 

             we started for our children 
                  up to 26 minds' depth     
                               joined in diameter
     drilling your blue stage of flame

80% hydrated victorious 
         spent to give and give

  I throw about forever 
 "I want to touch it for a minute" 

	</p>
	</pre>
	
	<button type="button">Submit</button>
	

	<!-- <div id="causeway-text"></div> -->

<script>

var colors = new Array(
  [62,35,255],
  [60,255,60],
  [255,35,98],
  [45,175,230],
  [255,0,255],
  [255,128,0]);

var step = 0;
// color table indices for: 
// current color left
// next color left
// current color right
// next color right
var colorIndices = [0,1,2,3];

//transition speed
var gradientSpeed = 0.002;

function updateGradient() {
  
	if ( $===undefined ) return;
  
	var c0_0 = colors[colorIndices[0]];
	var c0_1 = colors[colorIndices[1]];
	var c1_0 = colors[colorIndices[2]];
	var c1_1 = colors[colorIndices[3]];

	var istep = 1 - step;
	var r1 = Math.round(istep * c0_0[0] + step * c0_1[0]);
	var g1 = Math.round(istep * c0_0[1] + step * c0_1[1]);
	var b1 = Math.round(istep * c0_0[2] + step * c0_1[2]);
	var color1 = "rgb("+r1+","+g1+","+b1+")";

	var r2 = Math.round(istep * c1_0[0] + step * c1_1[0]);
	var g2 = Math.round(istep * c1_0[1] + step * c1_1[1]);
	var b2 = Math.round(istep * c1_0[2] + step * c1_1[2]);
	var color2 = "rgb("+r2+","+g2+","+b2+")";

	$('#gradient')
	.css({background: "-webkit-gradient(linear, left top, right top, from("+color1+"), to("+color2+"))"})
	.css({background: "-moz-linear-gradient(left, "+color1+" 0%, "+color2+" 100%)"});
	  
	step += gradientSpeed;

	if ( step >= 1 ) {
		step %= 1;
		colorIndices[0] = colorIndices[1];
		colorIndices[2] = colorIndices[3];

		//pick two new target color indices
		//do not pick the same as the current one
		colorIndices[1] = ( colorIndices[1] + Math.floor( 1 + Math.random() * (colors.length - 1))) % colors.length;
		colorIndices[3] = ( colorIndices[3] + Math.floor( 1 + Math.random() * (colors.length - 1))) % colors.length;
	}
}

setInterval(updateGradient,10);

// var socket = io.connect('127.0.0.1:8000');
var socket = io.connect(window.location.origin , {transports:['websocket']} );
// var socket = io.connect('https://atlab.cct.lsu.edu/', { path: '/causeway/socket.io' });
var myColor = getRandomColor();
var myLocation = [0.5, 0.5];	// Default centered

document.getElementsByTagName("body")[0].style.borderLeft = "15px solid " + myColor;
// seatMap.addEventListener("click", getClickPosition, false);

$(function () {
	var contents = $('p').text().split(' '),
	modText = '';

	for (var i = 0; i < contents.length; i++) {
		modText += '<span>' + contents[i] + '</span> ';
	}

	$('p').html(modText);

	$('p').click(function (e) {
		console.log("text:",$(e.target).text());
		$(e.target).toggleClass('underline');
		socket.emit('item', $(e.target).text());
	});

	$('button').click(function() {
		var selected = [];
		$('span.underline').each(function() {
			selected.push($(this).text());
		});
	
		// alert('Selected: ' + selected.join(','));
		// socket.emit('item', selected.join(','));
		
		for (var i=0;i<100;i++){
			socket.emit('item', '100 boooms');
		}
	});

});

function registerWithServer() {
	// Tone.startMobile();
	causeSound.triggerPitch();
	// causeSound.triggerCauseway();
	socket.emit('addme', {name: "a_user", color: myColor, note: causeSound.pitch, location: myLocation});
	document.getElementsByClassName("sd")[0].style.display = 'none';
	document.getElementsByClassName("st")[0].style.display = 'block';
}

socket.on('chat', function(data){
	console.log("chat: " + data);
});

socket.on('setSection', function(data) {
	console.log(data);
	console.log("the section is now: " + data.title);

	if (data.sect == "15") {
		Tone.startMobile();
		causeSound.playBrought();
	}
	
	if(data.title !== undefined){
		var otherClasses = document.querySelectorAll('.sec');

		for (var i = 0; i < otherClasses.length; i++) {
		    otherClasses[i].style.display = 'none';
		}

		document.getElementsByClassName("s"+data.sect)[0].style.display = 'block';
	}
	
});

function scrollto(element){ 
	var ele = document.getElementsByClassName("s"+element)[0];
    if (ele) {
    	window.scrollTo(0, ele.offsetTop);
    }
}

socket.on('itemback', function(data){
	console.log("itemback: " + data.phrase);

	var elements = document.getElementsByClassName(data.phrase);
	elements[0].className += " clicked";
});

function clickgo() {
	var elements = document.getElementsByClassName(this.className);
	socket.emit('item', elements[0].className.split(" ")[1]);
	elements[0].className += " clicked";
	elements[0].style.backgroundColor = myColor;
}

window.onload = function() {
	var xhr= new XMLHttpRequest();
	xhr.open('GET', 'data/score.txt', true);
	xhr.onreadystatechange= function() {
	    if (this.readyState!==4) return;
	    if (this.status!==200) return;
	    // document.getElementById("causeway-text").innerHTML= this.responseText;
	    addEvents();
	};
	xhr.send();

	function addEvents() {
		var phrases = document.getElementsByClassName('phrase');
		for (var i = 0; i < phrases.length; i++) {
			phrases[i].addEventListener("click", clickgo, false);
		}
	}

};

function getRandomColor() {
	var letters = '0123456789ABCDEF'.split('');
	var color = '#';
	for (var i = 0; i < 6; i++ ) {
	    color += letters[Math.floor(Math.random() * 16)];
	}
	return color;
}

var CauseSound = function () {
	this.tone = new Tone();
	this.synth = new Tone.SimpleSynth({
		"oscillator" : {
			"type" : "sine"
	 },
	 "envelope" : {
	 	"attack" : 2.0,
		"decay" : 0.5,
		"sustain" : 0.8,
		"release" : 2.0
	 }
	}).toMaster();
	
	this.player = new Tone.Player("data/wavs/001-Causeway.wav").toMaster();
	this.player2 = new Tone.Player("data/wavs/204-who%20had%20brought%20this%20one%20.wav").toMaster();

	
	this.pitchCollection = [55, 57, 59, 61, 62, 64, 66, 67, 68, 69, 71, 73, 75, 76, 78, 80, 82, 83];
	
	this.pitch = this.pitchCollection[Math.floor(Math.random() * (this.pitchCollection.length))];
	
	
	this.playPitch = function () {
		this.synth.triggerAttackRelease(this.tone.midiToNote(this.pitch+12), 5);
	};

	this.triggerPitch = function () {
		this.synth.triggerAttackRelease(this.tone.midiToNote(this.pitch+12), 5);
		socket.emit('triggerPitch', causeSound.pitch);
	};
	
	this.playCauseway = function() {
		this.player.start();
	};

	this.playBrought = function() {
		this.player2.start();
	};
	
	this.triggerCauseway = function() {
		this.synth.triggerAttackRelease(this.tone.midiToNote(this.pitch+12), 5);
		this.player.start();
		socket.emit('triggerCauseway', causeSound.pitch);
		
		var elements = document.getElementsByClassName("mainTitle");
		// elements[0].className += " clicked";
		elements[0].style.backgroundColor = myColor;
	};
};
		
</script>
	
<button type="button">Test 100</button>

</body>
</html>
